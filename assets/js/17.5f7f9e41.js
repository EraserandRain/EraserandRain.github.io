(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{583:function(s,a,e){"use strict";e.r(a);var n=e(10),t=Object(n.a)({},(function(){var s=this,a=s.$createElement,e=s._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"_1-reference"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-reference"}},[s._v("#")]),s._v(" 1. Reference")]),s._v(" "),e("p",[s._v("【"),e("a",{attrs:{href:"https://learnku.com/articles/49193",target:"_blank",rel:"noopener noreferrer"}},[s._v("简易实现 HTTPS （二） 自签名证书 | PHP 技术论坛 (learnku.com)"),e("OutboundLink")],1),s._v("】")]),s._v(" "),e("h2",{attrs:{id:"_2-概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-概述"}},[s._v("#")]),s._v(" 2. 概述")]),s._v(" "),e("p",[s._v("https自签名证书可以在线申请（阿里云DV型SSL证书、腾讯云等），也可以通过 "),e("code",[s._v("openssl")]),s._v(" 本地申请。这里介绍通过 "),e("code",[s._v("openssl")]),s._v(" 申请自签名证书。")]),s._v(" "),e("p",[s._v("注：本地申请的无效，无法像普通的https链接那样被信任，如果需要公网验证，还是需要通过在线申请。")]),s._v(" "),e("h2",{attrs:{id:"_3-步骤"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-步骤"}},[s._v("#")]),s._v(" 3. 步骤")]),s._v(" "),e("h3",{attrs:{id:"申请证书"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#申请证书"}},[s._v("#")]),s._v(" 申请证书")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" nginx/conf\n"),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p cert "),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" cert\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[s._v("检查 "),e("code",[s._v("openssl")]),s._v(" 版本")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("openssl version\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("使用 "),e("code",[s._v("des3")]),s._v(" 生成 4096 比特位服务器私钥")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("openssl genrsa -des3 -out server.key "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("生成证书签名请求文件，注意填写域名或者 IP 地址（Common Name）")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("openssl req -new -key server.key -out server.csr\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("生成 4096 位 "),e("code",[s._v("ca")]),s._v(" 私钥")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("openssl genrsa -des3 -out ca.key "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("去除服务器私钥避免以后每次载入文件需要输入密码")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("openssl rsa -in server.key -out server.key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("以 x509 证书格式标准生成 10 年的 crt ，注意填写域名或者 IP 地址（Common Name）")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("openssl req -new -x509 -key ca.key -out ca.crt -days "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("3650")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("请求有效期为 3650 天 传入文件为 "),e("code",[s._v("server.csr")]),s._v(" 指定 CA 文件为 "),e("code",[s._v("ca.crt")]),s._v(" 指定私钥文件为 "),e("code",[s._v("ca.key")]),s._v(" 并自动创建 CA 序列文件 输出证书文件 "),e("code",[s._v("server.crt")]),s._v(" 至此签名成功")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("openssl x509 -req -days "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("365")]),s._v(" -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("完成后，"),e("code",[s._v("cert")]),s._v(" 目录下应有6个文件")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("cert\n├── ca.crt\n├── ca.key\n├── ca.srl\n├── server.crt\n├── server.csr\n└── server.key\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h3",{attrs:{id:"nginx-配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置"}},[s._v("#")]),s._v(" Nginx 配置")]),s._v(" "),e("p",[s._v("检查是否安装 "),e("code",[s._v("http_ssl_module")]),s._v(" 模块")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("nginx -V\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("code",[s._v("nginx")]),s._v(" 配置")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("server "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      listen       "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("58088")]),s._v("  ssl"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      server_name     www.trunkey.com"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server_name 为对应IP或域名")]),s._v("\n      ssl_certificate ./cert/server.crt"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      ssl_certificate_key ./cert/server.key"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      location / "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n      index index.html index.php"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      rewrite ^/"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("WebService/"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("Command"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(".*"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("$ /webservice.php last"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      root  /server/abchosting/www/isms/wwwroot"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      location ~ .*"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("."),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("php"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("php5"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("?$\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("   \n        fastcgi_pass "),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9000"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        fastcgi_index index.php"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        include fastcgi.conf"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n      "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("重新加载")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);