(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{589:function(t,s,a){"use strict";a.r(s);var e=a(10),r=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_1-介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-介绍"}},[t._v("#")]),t._v(" "),a("strong",[t._v("1. 介绍")])]),t._v(" "),a("aside",[t._v("rsyslog：Rocket-fast system for log")]),t._v(" "),a("p",[t._v("Centos 6 版本之后，系统默认安装 rsyslog 服务。")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("rpm")]),t._v(" -aq "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" rsyslog\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 查看是否安装")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#组件"}},[t._v("#")]),t._v(" 组件")]),t._v(" "),a("ul",[a("li",[t._v("主程序："),a("code",[t._v("/usr/sbin/rsyslogd")])]),t._v(" "),a("li",[t._v("配置文件："),a("code",[t._v("/etc/rsyslog.conf")]),t._v("，"),a("code",[t._v("/etc/rsyslog.d*.conf")])]),t._v(" "),a("li",[t._v("库文件："),a("code",[t._v("/lib64/rsyslog/*.so")])])]),t._v(" "),a("h2",{attrs:{id:"_2-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置文件"}},[t._v("#")]),t._v(" "),a("strong",[t._v("2. 配置文件")])]),t._v(" "),a("p",[t._v("rsyslog 服务的配置文件（"),a("code",[t._v("/etc/rsyslog.conf")]),t._v("）由 MODULES（模块），GLOBAL DIRECTIVES（全局设置），RULES（规则）组成，会覆盖系统syslog配置（"),a("code",[t._v("/etc/syslog.conf")]),t._v("）。")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("rsyslogd -f /etc/rsyslog.conf -N1\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 检查 rsyslog.conf 配置")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"modules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#modules"}},[t._v("#")]),t._v(" "),a("strong",[t._v("MODULES")])]),t._v(" "),a("p",[t._v("rsyslog 为模块化设计，可以支持导入多种模块。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("MODULES")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("omsnmp")]),t._v(" "),a("td",[t._v("SNMP trap 输出模块")])]),t._v(" "),a("tr",[a("td",[t._v("omgssapi")]),t._v(" "),a("td",[t._v("GSS-enabled syslog 输出模块")])]),t._v(" "),a("tr",[a("td",[t._v("ommysql")]),t._v(" "),a("td",[t._v("MySQL 输出模块")])]),t._v(" "),a("tr",[a("td",[t._v("imfile")]),t._v(" "),a("td",[t._v("文本文件输入模块")])]),t._v(" "),a("tr",[a("td",[t._v("imudp")]),t._v(" "),a("td",[t._v("UDP syslog 输入插件")])]),t._v(" "),a("tr",[a("td",[t._v("imtcp")]),t._v(" "),a("td",[t._v("普通 TCP syslog 输入插件，服务端需要打开这个模块，rsyslog才能接收客户端的日志。")])])])]),t._v(" "),a("h3",{attrs:{id:"global-directives"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#global-directives"}},[t._v("#")]),t._v(" "),a("strong",[t._v("GLOBAL DIRECTIVES")])]),t._v(" "),a("h3",{attrs:{id:"rules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rules"}},[t._v("#")]),t._v(" RULES")]),t._v(" "),a("p",[t._v("由 "),a("code",[t._v("Facility")]),t._v("，"),a("code",[t._v("Priority")]),t._v("，"),a("code",[t._v("Target")]),t._v(" 组成，配置格式如下：")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#### RULES ####")]),t._v("\nFacility1.Proirity1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("Fcility2.Priority2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\t\t\tTarget\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("ul",[a("li",[a("p",[a("code",[t._v("Facility")]),t._v("：打印日志信息的模块名，可自定义。")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Facility（设施）")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("auth")]),t._v(" "),a("td",[t._v("PAM产生的日志，认证日志")])]),t._v(" "),a("tr",[a("td",[t._v("authpriv")]),t._v(" "),a("td",[t._v("FTP,SSH等登陆认证日志")])]),t._v(" "),a("tr",[a("td",[t._v("mail")]),t._v(" "),a("td",[t._v("邮件日志")])]),t._v(" "),a("tr",[a("td",[t._v("cron")]),t._v(" "),a("td",[t._v("计划任务（时钟进程）")])]),t._v(" "),a("tr",[a("td",[t._v("kern")]),t._v(" "),a("td",[t._v("内核启动日志")])]),t._v(" "),a("tr",[a("td",[t._v("FTP")]),t._v(" "),a("td",[t._v("FTP日志信息")])]),t._v(" "),a("tr",[a("td",[t._v("USER")]),t._v(" "),a("td",[t._v("默认，生成用户级别消息")])]),t._v(" "),a("tr",[a("td",[t._v("SYSLOG")]),t._v(" "),a("td",[t._v("系统日志信息")])]),t._v(" "),a("tr",[a("td",[t._v("*****")]),t._v(" "),a("td",[t._v("所有的facility")])])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Priority")]),t._v("：指明日志重要性级别（从上到下递减，先左后右递减）")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Priority")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("emerg")]),t._v(" "),a("td",[t._v("系统不可用")])]),t._v(" "),a("tr",[a("td",[t._v("alert")]),t._v(" "),a("td",[t._v("闭幕马上采取措施")])]),t._v(" "),a("tr",[a("td",[t._v("crit")]),t._v(" "),a("td",[t._v("关键事件")])]),t._v(" "),a("tr",[a("td",[t._v("err")]),t._v(" "),a("td",[t._v("错误事件")])]),t._v(" "),a("tr",[a("td",[t._v("warn")]),t._v(" "),a("td",[t._v("警告事件")])]),t._v(" "),a("tr",[a("td",[t._v("notice")]),t._v(" "),a("td",[t._v("具有重要性的普通事件")])]),t._v(" "),a("tr",[a("td",[t._v("info")]),t._v(" "),a("td",[t._v("有用事件")])]),t._v(" "),a("tr",[a("td",[t._v("debug")]),t._v(" "),a("td",[t._v("调试信息")])]),t._v(" "),a("tr",[a("td",[t._v("*****")]),t._v(" "),a("td",[t._v("所有级别")])]),t._v(" "),a("tr",[a("td",[t._v("none")]),t._v(" "),a("td",[t._v("不记录")])])])])]),t._v(" "),a("li",[a("p",[a("code",[t._v("Target")]),t._v("：存储与指定日志文件中")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Target")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("指定的文件路径")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("日志服务器")]),t._v(" "),a("td",[a("code",[t._v("@ip")]),t._v("，UDP方式将日志送往指定远程服务器记录；"),a("code",[t._v("@@ip")]),t._v(" 是TCP方式")])]),t._v(" "),a("tr",[a("td",[t._v("管道")]),t._v(" "),a("td",[t._v("转发给其他命令处理")])])])])])]),t._v(" "),a("h2",{attrs:{id:"_3-客户端配置输出到服务端"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-客户端配置输出到服务端"}},[t._v("#")]),t._v(" "),a("strong",[t._v("3. 客户端配置输出到服务端")])]),t._v(" "),a("p",[t._v("行尾新增以下内容，修改后重启服务即可。")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#### RULES ####")]),t._v("\n*.* @@remote-IP:514\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 转发配置文件中所有模块到 remote-IP 的 514 端口")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("h2",{attrs:{id:"_4-指定程序日志转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-指定程序日志转发"}},[t._v("#")]),t._v(" "),a("strong",[t._v("4. 指定程序日志转发")])]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#### MODULES ####")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("load"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"imfile"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PollingInterval")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"5"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 加载 imfile 模块")]),t._v("\ninput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"imfile"')]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 模块类型")]),t._v("\n\t\t  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("File")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 指定程序日志生成的路径")]),t._v("\n\t\t  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Tag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\t  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Severity")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('""')]),t._v("\n\t\t\t\t"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## 重要性级别，见 Priority 中的内容")]),t._v("\n\t\t  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Facility")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"facility_name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("p",[t._v("多个 imfile 模块导入 添加多个 input 即可。")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"title"}),a("p",[t._v("注：符号链接会破坏 imfile 读取，可能引起 "),a("code",[t._v("imfile: '' is FILE but DIRECTORY expected - ignored)")]),t._v(" 报错，input 中 imfile 文件路径不能包含符号链接。")])]),a("h3",{attrs:{id:"指定采集-mysql-日志转发"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#指定采集-mysql-日志转发"}},[t._v("#")]),t._v(" 指定采集 mysql 日志转发")]),t._v(" "),a("p",[t._v("配置 "),a("code",[t._v("/etc/my.cnf")]),t._v(" 添加如下")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mysqld"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\ngeneral-log-file"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/log/syslog/mysql-general.log\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("mysqld_safe"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\nsyslog\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[a("code",[t._v("[mysqld]")]),t._v(" 中定义的为常规日志和慢查询日志，"),a("code",[t._v("[mysqld_safe]")]),t._v(" 中定义的为错误日志。")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"title"}),a("p",[t._v("注意："),a("code",[t._v("mysqld")]),t._v(" 中设置的文件及其目录归属为 "),a("code",[t._v("mysql:mysql")]),t._v("，权限 664 即可。")])]),a("p",[a("code",[t._v("/etc/rsyslog.conf")]),t._v(" 引入 mysql 模块")]),t._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#### MODULES ####")]),t._v("\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("load"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"imfile"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("PollingInterval")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\ninput"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"imfile"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("File")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/var/log/syslog/mysql-general.log"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Tag")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mysql-general"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Severity")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"warning"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("Facility")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"local1"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#### RULE ####")]),t._v("\nlocal1.* @@remote_IP:514\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br")])]),a("h2",{attrs:{id:"_5-reference"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-reference"}},[t._v("#")]),t._v(" 5. Reference")]),t._v(" "),a("p",[t._v("【"),a("a",{attrs:{href:"https://blog.clanzx.net/software/rsyslog.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("rsyslog 配置简介 — blog.clanzx.net 0.1 文档"),a("OutboundLink")],1),t._v("】")]),t._v(" "),a("p",[t._v("【"),a("a",{attrs:{href:"https://www.jianshu.com/p/e129ed893362",target:"_blank",rel:"noopener noreferrer"}},[t._v("日志管理Rsyslog - 简书 (jianshu.com)"),a("OutboundLink")],1),t._v("】")]),t._v(" "),a("p",[t._v("【"),a("a",{attrs:{href:"https://blog.csdn.net/weixin_31789689/article/details/108556277",target:"_blank",rel:"noopener noreferrer"}},[t._v("Centos对Rsyslog日志远程转发和Mysql日志存储_宇文忠的博客-CSDN博客"),a("OutboundLink")],1),t._v("】")]),t._v(" "),a("p",[t._v("【"),a("a",{attrs:{href:"https://bugs.centos.org/view.php?id=15565",target:"_blank",rel:"noopener noreferrer"}},[t._v("0015565: imfile and symlinks not working - CentOS Bug Tracker"),a("OutboundLink")],1),t._v("】")]),t._v(" "),a("p",[t._v("【"),a("a",{attrs:{href:"https://www.rsyslog.com/doc/v8-stable/configuration/modules/imfile.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("RSyslog Documentation - rsyslog"),a("OutboundLink")],1),t._v("】")])])}),[],!1,null,null,null);s.default=r.exports}}]);